<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hindi to English OCR & Translator</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f8f9fa;
      color: #333;
    }
    h2, h3 {
      color: #2c3e50;
    }
    pre {
      background: #fff;
      padding: 1rem;
      border: 1px solid #ccc;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    button {
      padding: 0.6rem 1rem;
      margin-top: 1rem;
      background: #3498db;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    input[type="file"] {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h2>Hindi PDF to English Translator (Browser Only)</h2>
  <input type="file" id="pdf-upload" accept="image/*,.pdf"/>
  <button onclick="processFile()">Start OCR & Translate</button>

  <h3>Extracted Hindi Text</h3>
  <pre id="hindi-text">...</pre>

  <h3>Translated English Text</h3>
  <pre id="english-text">...</pre>

  <h3>Summaries</h3>
  <strong>Hindi Summary:</strong>
  <pre id="hindi-summary">...</pre>

  <strong>English Summary:</strong>
  <pre id="english-summary">...</pre>

  <button onclick="generatePDF()">Download PDF</button>

  <script>
    let hindiText = "";
    let englishText = "";

    async function processFile() {
      const fileInput = document.getElementById("pdf-upload");
      const file = fileInput.files[0];
      if (!file) return alert("Please upload an image or scanned PDF page.");

      // Use FileReader to convert to dataURL
      const reader = new FileReader();
      reader.onload = async function () {
        const imageData = reader.result;

        // OCR using Tesseract.js (Hindi)
        const { createWorker } = Tesseract;
        const worker = await createWorker("hin");
        const result = await worker.recognize(imageData);
        await worker.terminate();

        hindiText = result.data.text;
        document.getElementById("hindi-text").textContent = hindiText;

        // Translate using LibreTranslate
        const translated = await translateText(hindiText);
        englishText = translated;
        document.getElementById("english-text").textContent = englishText;

        // Basic summaries (first 500 chars)
        document.getElementById("hindi-summary").textContent = hindiText.slice(0, 500) + "...";
        document.getElementById("english-summary").textContent = englishText.slice(0, 500) + "...";
      };
      reader.readAsDataURL(file);
    }

    async function translateText(text) {
      const response = await fetch("https://libretranslate.com/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          q: text,
          source: "hi",
          target: "en",
          format: "text"
        })
      });
      const data = await response.json();
      return data.translatedText;
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "portrait", unit: "pt", format: "a4" });
      let y = 30;

      doc.setFontSize(12);
      doc.text("Hindi Text:", 30, y);
      y += 20;
      doc.text(hindiText.slice(0, 1000), 30, y, { maxWidth: 540 });

      y += 120;
      doc.text("English Translation:", 30, y);
      y += 20;
      doc.text(englishText.slice(0, 1000), 30, y, { maxWidth: 540 });

      y += 120;
      doc.text("Hindi Summary:", 30, y);
      y += 20;
      doc.text(document.getElementById("hindi-summary").textContent, 30, y, { maxWidth: 540 });

      y += 120;
      doc.text("English Summary:", 30, y);
      y += 20;
      doc.text(document.getElementById("english-summary").textContent, 30, y, { maxWidth: 540 });

      doc.save("hindi_to_english_translation.pdf");
    }
  </script>
</body>
</html>
