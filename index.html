
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hindi to English Legal Translator</title>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f9f9f9; }
    h2, h3 { color: #2c3e50; }
    pre { background: #fff; padding: 1rem; border: 1px solid #ccc; max-height: 200px; overflow-y: auto; white-space: pre-wrap; }
    button { padding: 0.6rem 1rem; background: #2980b9; color: #fff; border: none; cursor: pointer; margin-top: 1rem; border-radius: 5px; }
    input[type="file"] { margin: 1rem 0; }
  </style>
</head>
<body>
  <h2>Hindi PDF Legal Translator (Client-Side)</h2>
  <input type="file" id="file-upload" accept=".pdf,image/*" />
  <button onclick="handleUpload()">Start OCR + Translate</button>

  <h3>Hindi Text Extracted</h3>
  <pre id="hindi-text">...</pre>

  <h3>Translated English Text</h3>
  <pre id="english-text">...</pre>

  <h3>Summaries</h3>
  <strong>Hindi Summary:</strong><pre id="hindi-summary">...</pre>
  <strong>English Summary:</strong><pre id="english-summary">...</pre>

  <button onclick="downloadPDF()">Download PDF</button>

  <script>
    let hindiText = "";
    let englishText = "";

    async function handleUpload() {
      const file = document.getElementById("file-upload").files[0];
      if (!file) return alert("Upload a PDF or image file.");

      if (file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = async () => {
          const typedArray = new Uint8Array(reader.result);
          const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;
          let fullText = "";

          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(" ");
            fullText += pageText + "\n";
          }

          if (fullText.trim().length < 10) {
            const imageReader = new FileReader();
            imageReader.onload = async () => {
              const worker = await Tesseract.createWorker("hin");
              const result = await worker.recognize(imageReader.result);
              await worker.terminate();
              processText(result.data.text);
            };
            imageReader.readAsDataURL(file);
          } else {
            processText(fullText);
          }
        };
        reader.readAsArrayBuffer(file);
      } else if (file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = async () => {
          const worker = await Tesseract.createWorker("hin");
          const result = await worker.recognize(reader.result);
          await worker.terminate();
          processText(result.data.text);
        };
        reader.readAsDataURL(file);
      } else {
        alert("Only PDF or image files are supported.");
      }
    }

    async function processText(hindi) {
      hindiText = hindi;
      document.getElementById("hindi-text").textContent = hindiText;

      const translated = await fetch("https://libretranslate.com/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          q: hindiText,
          source: "hi",
          target: "en",
          format: "text"
        })
      });
      const result = await translated.json();
      englishText = result.translatedText;
      document.getElementById("english-text").textContent = englishText;

      document.getElementById("hindi-summary").textContent = hindiText.slice(0, 400) + "...";
      document.getElementById("english-summary").textContent = englishText.slice(0, 400) + "...";
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "pt", "a4");
      let y = 40;

      doc.setFontSize(12);
      doc.text("Hindi Text:", 40, y); y += 20;
      doc.text(hindiText.substring(0, 1000), 40, y, { maxWidth: 500 }); y += 140;

      doc.text("English Translation:", 40, y); y += 20;
      doc.text(englishText.substring(0, 1000), 40, y, { maxWidth: 500 }); y += 140;

      doc.text("Summaries:", 40, y); y += 20;
      doc.text("Hindi Summary: " + document.getElementById("hindi-summary").textContent, 40, y, { maxWidth: 500 }); y += 60;
      doc.text("English Summary: " + document.getElementById("english-summary").textContent, 40, y, { maxWidth: 500 });

      doc.save("translated_output.pdf");
    }
  </script>
</body>
</html>
